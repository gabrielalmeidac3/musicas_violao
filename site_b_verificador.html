<!DOCTYPE html>
<html>
<head>
  <title>Site B - Verificador</title>
</head>
<body>
  <h1>üîç Site B - Verificando login do Site A...</h1>
  <div id="resultado">‚è≥ Aguardando resposta...</div>

  <iframe id="iframeA" src="https://viocomg.github.io/cursofechadoviolao/site_a_login.html" style="display:none;"></iframe>

  <script>
    console.log("[Site B] üöÄ Iniciando verifica√ß√£o...");

    const iframe = document.getElementById("iframeA");
    const resultado = document.getElementById("resultado");
    let respostaRecebida = false;

    // Define origem esperada para validar mensagens
    const origemEsperada = "https://viocomg.github.io";

    // Escuta respostas do Site A
    window.addEventListener("message", (event) => {
      console.log("[Site B] üì© Mensagem recebida de:", event.origin, event.data);

      // Confere se a mensagem veio da origem esperada
      if (event.origin !== origemEsperada) {
        console.warn("[Site B] ‚ö†Ô∏è Origem inesperada da mensagem:", event.origin);
        return;
      }

      if (event.data.type === "loginStatus") {
        respostaRecebida = true;
        if (event.data.loggedIn) {
          console.log("[Site B] ‚úÖ Usu√°rio est√° logado no Site A! UID:", event.data.uid);
          resultado.innerText = "‚úÖ Logado no Site A!";
        } else {
          console.log("[Site B] ‚ùå Usu√°rio N√ÉO est√° logado no Site A.");
          resultado.innerText = "‚ùå N√£o logado no Site A.";
        }
      }
    });

    // Quando o iframe carregar, envia a mensagem para checar login
    iframe.onload = () => {
      console.log("[Site B] ‚úÖ Iframe carregado. Enviando verifica√ß√£o para Site A...");
      const message = { type: "checkLogin" };
      iframe.contentWindow.postMessage(message, origemEsperada);
      console.log("[Site B] üì§ Mensagem enviada:", message, "para", origemEsperada);

      // Timeout de 5 segundos para aguardar resposta
      setTimeout(() => {
        if (!respostaRecebida) {
          console.warn("[Site B] ‚è∞ Tempo limite atingido. Nenhuma resposta do Site A.");
          resultado.innerText = "‚ö†Ô∏è Sem resposta do Site A.";
        }
      }, 5000);
    };
  </script>
</body>
</html>
