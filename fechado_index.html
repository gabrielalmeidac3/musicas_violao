<!DOCTYPE html>
<html lang="pt-BR">
<!--teste-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curso de Violão do Zero ao Repertório</title>
    <link rel="stylesheet" href="fechado_styles.css">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>



<body>
    <div id="loading">Carregando Curso <br>Do Zero ao Repertório</div>
    <div id="content"></div>
    <div class="logout-button" onclick="logout()">Sair</div>

    <script>
        // Declarar auth e db globalmente
        let auth = null;
        let db = null;
    
        // Inicializar Firebase apenas se ainda não foi inicializado
        if (!firebase.apps.length) {
            fetch('https://broken-silence-aaa9.2gabrielekaline.workers.dev')
                .then(response => response.json())
                .then(firebaseConfig => {
                    firebase.initializeApp(firebaseConfig);
                    auth = firebase.auth();
                    db = firebase.firestore();
                    console.log('Firebase inicializado com configuração segura!');
                    loadContent();
                })
                .catch(error => console.error('Erro ao carregar configuração do Firebase:', error));
        } else {
            auth = firebase.auth();
            db = firebase.firestore();
            console.log('Firebase já inicializado.');
            loadContent();
        }
    
        function loadContent() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    const telefone = user.email.split('@')[0];
                    db.collection('alunos').where('telefone', '==', telefone).get()
                        .then((snapshot) => {
                            if (!snapshot.empty && snapshot.docs[0].data().acesso === 'Liberado') {
                                fetch('fechado_curso.html').then(response => response.text()).then(data => {
                                    document.getElementById('content').innerHTML = data;
                                    const urlParams = new URLSearchParams(window.location.search);
                                    const from = urlParams.get('from');
                                    window.voltarPaginaGeral = function() {
                                        window.location.href = from === 'geral2' ? 'fechado_geral2.html' : 'fechado_geral_protegido_site.html';
                                    };
                                    // Execute scripts from fechado_curso.html
                                    const script = document.createElement('script');
                                    script.textContent = `
                                        document.querySelector('.toggle-header').textContent = 'Procurar aulas';
                                        
                                        function toggleSongList(element) {
                                            const list = element.nextElementSibling;
                                            const isOpen = list.style.display === 'block';
                                            list.style.display = isOpen ? 'none' : 'block';
                                            element.style.color = isOpen ? 'white' : 'rgb(255, 188, 188)';
                                            element.textContent = isOpen ? element.getAttribute('data-original-text') : 'Fechar lista';
                                        }
                                        
                                        function toggleSection(element) {
                                            const content = element.nextElementSibling;
                                            const isOpen = content.style.display === 'block';
                                            content.style.display = isOpen ? 'none' : 'block';
                                            element.textContent = isOpen ? 'Procurar aulas' : 'Procurar aulas (fechar)';
                                        }
                                        
                                        function scrollToLesson(lessonNumber) {
                                            const lesson = document.getElementById(\`lesson-\${lessonNumber}\`);
                                            if (lesson) {
                                                lesson.scrollIntoView({ behavior: 'smooth' });
                                                const wrapper = lesson.querySelector('.video-wrapper');
                                                loadVideo(wrapper);
                                            }
                                        }
                                        
                                        function loadVideo(element) {
                                            const src = element.getAttribute('data-src');
                                            element.innerHTML = \`<iframe src="\${src}?autoplay=1&rel=0&showinfo=0&iv_load_policy=3&modestbranding=1" frameborder="0" allowfullscreen></iframe>\`;
                                        }
                                        
                                        function toggleDescription(element) {
                                            const description = element.nextElementSibling;
                                            description.style.display = description.style.display === 'block' ? 'none' : 'block';
                                            element.textContent = description.style.display === 'block' ? 'Ocultar descrição' : 'Mostrar descrição';
                                        }
                                        
                                        function scrollToTop() {
                                            window.scrollTo({ top: 0, behavior: 'smooth' });
                                        }
                                        
                                        // Sistema de busca
                                        let filteredResults = [];
                                        const lessons = [
                                            { id: 0, title: "Aula de Boas Vindas Curso do Zero Ao Repertório", module: "M1", keywords: "boas vindas apresentação início começar" },
                                            { id: 1, title: "Como Tocar Violão Sem Teoria", module: "M1", keywords: "sem teoria prático básico iniciante" },
                                            { id: 2, title: "Mentalidade Pra Aprender Violão", module: "M1", keywords: "mentalidade motivação persistência paciência" },
                                            { id: 3, title: "Como Escolher o Seu Violão", module: "M1", keywords: "escolher violão comprar instrumento" },
                                            { id: 4, title: "Como Afinar o Violão", module: "M1", keywords: "afinar afinação cordas som" },
                                            { id: 5, title: "Como Segurar o Violão", module: "M1", keywords: "segurar postura posição corpo" },
                                            { id: 6, title: "O Que São Acordes Parte 1", module: "M1", keywords: "acordes básico teoria harmonia" },
                                            { id: 7, title: "O Que São Acordes Parte 2", module: "M1", keywords: "acordes continuação teoria" },
                                            { id: 8, title: "O Que São Diagramas de Acordes", module: "M1", keywords: "diagramas acordes representação visual" },
                                            { id: 9, title: "Aprenda Todos os Acordes", module: "M1", keywords: "todos acordes dicionário família" },
                                            { id: 10, title: "Fazendo Acordes na Prática", module: "M1", keywords: "prática acordes exercício treino" },
                                            { id: 11, title: "Aumente a Velocidade nas Trocas de Acordes", module: "M1", keywords: "velocidade troca acordes rapidez" },
                                            { id: 12, title: "Acordes de pestana feitos sem pestana", module: "M1", keywords: "pestana acordes sem facilitar" },
                                            { id: 13, title: "O que são e como fazer Ritmos", module: "M1", keywords: "ritmos batida compasso tempo" },
                                            { id: 14, title: "Como Fazer Qualquer Ritmo no Violão", module: "M1", keywords: "qualquer ritmo técnica método" },
                                            { id: 15, title: "Dicas Sobre Ritmos", module: "M1", keywords: "dicas ritmos conselhos" },
                                            { id: 16, title: "Ritmos Fáceis Guarânia", module: "M1", keywords: "guarânia ritmo fácil básico" },
                                            { id: 17, title: "Ritmos Fáceis Valsa", module: "M1", keywords: "valsa ritmo fácil básico" },
                                            { id: 18, title: "Como Tocar Qualquer Música no Violão", module: "M1", keywords: "qualquer música tocar método" },
                                            { id: 19, title: "Toque Sua Primeira Música", module: "M1", keywords: "primeira música começar prática" },
                                            { id: 20, title: "A Única Coisa", module: "M1", keywords: "música única coisa prática" },
                                            { id: 21, title: "O Que São Cifras", module: "M1", keywords: "cifras notação símbolos" },
                                            { id: 22, title: "Encontrando Cifras", module: "M1", keywords: "encontrar cifras sites buscar" },
                                            { id: 23, title: "+450 Cifras Simples", module: "M1", keywords: "450 cifras simples repertório" },
                                            { id: 24, title: "Juntando Ritmo e Acordes", module: "M1", keywords: "juntar ritmo acordes coordenação" },
                                            { id: 25, title: "Encaixe da Voz Dicas", module: "M1", keywords: "voz cantar encaixe dicas" },
                                            { id: 26, title: "Encaixe da Voz Na prática", module: "M1", keywords: "voz cantar prática encaixe" },
                                            { id: 27, title: "Como Criar um Repertório", module: "M1", keywords: "repertório criar músicas lista" },
                                            { id: 28, title: "Ritmo de Rock", module: "M2", keywords: "rock ritmo batida estilo" },
                                            { id: 29, title: "Ritmo Pop Rock", module: "M2", keywords: "pop rock ritmo batida" },
                                            { id: 30, title: "Ritmo de Toada", module: "M2", keywords: "toada ritmo regional" },
                                            { id: 31, title: "Ritmo de Vanera", module: "M2", keywords: "vanera ritmo regional" },
                                            { id: 32, title: "Ritmo de 6 por 8", module: "M2", keywords: "6 por 8 ritmo compasso" },
                                            { id: 33, title: "Quebra de Ritmo", module: "M2", keywords: "quebra ritmo variação" },
                                            { id: 34, title: "Como Aprender Ritmo em Outros Lugares", module: "M2", keywords: "aprender ritmo outros lugares" },
                                            { id: 35, title: "Aprenda Ritmo na Prática Comigo", module: "M2", keywords: "ritmo prática exercício" },
                                            { id: 36, title: "Ritmo Bolero Bachata", module: "M2", keywords: "bolero bachata ritmo latino" },
                                            { id: 37, title: "Ritmo Country 1 e 2", module: "M2", keywords: "country ritmo americano" },
                                            { id: 38, title: "Pestanas", module: "M3", keywords: "pestana técnica avançada" },
                                            { id: 39, title: "Como Fazer Dedilhado", module: "M3", keywords: "dedilhado técnica dedos" },
                                            { id: 40, title: "Ritmos de Dedilhado Parte 1", module: "M3", keywords: "dedilhado ritmos parte 1" },
                                            { id: 41, title: "Ritmos de Dedilhado Parte 2", module: "M3", keywords: "dedilhado ritmos parte 2" },
                                            { id: 42, title: "O Que São e Como Fazer Solos", module: "M3", keywords: "solos melodia técnica" },
                                            { id: 43, title: "Como Ler Tablaturas", module: "M3", keywords: "tablatura ler notação" },
                                            { id: 44, title: "Elementos da Tablatura Parte 1", module: "M3", keywords: "tablatura elementos símbolos" },
                                            { id: 45, title: "Elementos da Tablatura Parte 2", module: "M3", keywords: "tablatura elementos continuação" },
                                            { id: 46, title: "Como Encontrar Tablaturas", module: "M3", keywords: "encontrar tablatura sites" },
                                            { id: 47, title: "O que é Tocar de Ouvido", module: "M3", keywords: "tocar ouvido percepção" },
                                            { id: 48, title: "Apostila Teoria Musical PDF", module: "M3", keywords: "teoria musical apostila pdf" },
                                            { id: 49, title: "Escala Cromática", module: "M3", keywords: "escala cromática notas" },
                                            { id: 50, title: "O que é Tom", module: "M3", keywords: "tom tonalidade altura" },
                                            { id: 51, title: "O Que é Campo Harmônico e Como Usar", module: "M3", keywords: "campo harmônico acordes família" },
                                            { id: 52, title: "Como Tocar de Ouvido Parte 1", module: "M3", keywords: "tocar ouvido parte 1" },
                                            { id: 53, title: "Como Tocar de Ouvido Parte 2", module: "M3", keywords: "tocar ouvido parte 2" },
                                            { id: 54, title: "Sistema CAGED", module: "M3", keywords: "sistema caged acordes" },
                                            { id: 55, title: "Como Descobrir o Tom da Música", module: "M3", keywords: "descobrir tom música" },
                                            { id: 56, title: "Perca a Vergonha de Tocar em Público", module: "M4", keywords: "vergonha público apresentar" },
                                            { id: 57, title: "Como Continuar Aprendendo no Violão Sempre", module: "M4", keywords: "continuar aprendendo sempre" },
                                            { id: 58, title: "Acompanhamento Violão em Ação", module: "M4", keywords: "acompanhamento prática" },
                                            { id: 59, title: "Depoimentos Gabriel Almeida", module: "M4", keywords: "depoimentos testemunhos" },
                                            { id: 60, title: "Finalização do Curso", module: "M4", keywords: "finalização fim conclusão" }
                                        ];
                                        
                                        function searchFor(query) {
                                            document.getElementById('searchInput').value = query;
                                            performSearch(query);
                                        }
                                        
                                        function getAulaPrefix(lesson) {
                                            if (lesson.module === 'M1') {
                                                return lesson.id === 0 ? '' : 'Aula ' + lesson.id + ' ';
                                            } else if (lesson.module === 'M2') {
                                                return 'Aula ' + (lesson.id - 27) + ' ';
                                            } else if (lesson.module === 'M3') {
                                                return 'Aula ' + (lesson.id - 36) + ' ';
                                            } else if (lesson.module === 'M4') {
                                                return 'Aula ' + (lesson.id - 54) + ' ';
                                            }
                                            return '';
                                        }
                                        
                                        function performSearch(query) {
                                            currentPage = 0;
                                            filteredResults = lessons.filter(lesson => {
                                                const prefix = getAulaPrefix(lesson);
                                                const searchText = \`\${lesson.module} \${prefix}\${lesson.title}\`.toLowerCase();
                                                return searchText.includes(query.toLowerCase());
                                            });
                                        
                                            const resultsContainer = document.getElementById('searchResults');
                                            resultsContainer.innerHTML = '';
                                        
                                            displayResults(filteredResults, query);
                                        }
                                        
                                        
                                        let currentPage = 0;
                                        const resultsPerPage = 10;
                                        
                                        function displayResults(results, query) {
                                            const resultsContainer = document.getElementById('searchResults');
                                            
                                        
                                            if (query.trim() === '') {
                                                resultsContainer.style.display = 'none';
                                                return;
                                            }
                                        
                                            if (results.length === 0) {
                                                resultsContainer.innerHTML = '<div class="no-results">Nenhuma aula encontrada para "' + query + '"</div>';
                                                resultsContainer.style.display = 'block';
                                                return;
                                            }
                                        
                                            const start = currentPage * resultsPerPage;
                                            const end = start + resultsPerPage;
                                            const paginatedResults = results.slice(start, end);
                                            
                                            const html = paginatedResults.map(lesson => {
                                                const prefix = getAulaPrefix(lesson);
                                                return \`
                                                    <div class="search-result-item" onclick="goToLesson(\${lesson.id})">
                                                        <div class="result-title">\${lesson.module} \${prefix}\${lesson.title}</div>
                                                    </div>
                                                \`;
                                            }).join('');
                                        
                                            let buttonHtml = '';
                                            if (end < results.length) {
                                                buttonHtml = \`
                                                    <div class="search-result-item" style="background: #2594a3; padding: 15px 20px; cursor: pointer;" onclick="showMoreResults()">
                                                        <div class="result-title">Ver mais</div>
                                                    </div>
                                                \`;
                                            }
                                        
                                            const oldButton = resultsContainer.querySelector('.ver-mais-btn');
                                            if (oldButton) oldButton.remove();
                                        
                                            resultsContainer.insertAdjacentHTML('beforeend', html);
                                        
                                            if (end < results.length) {
                                                resultsContainer.insertAdjacentHTML('beforeend', \`
                                                    <div class="search-result-item ver-mais-btn" style="background:#2594a3;padding:15px 20px;cursor:pointer;" onclick="showMoreResults(event)">
                                                        <div class="result-title">Ver mais</div>
                                                    </div>
                                        
                                                \`);
                                            }
                                        
                                            resultsContainer.style.display = 'block';
                                        }
                                        
                                        function showMoreResults(ev) {
                                            if (ev) {
                                                ev.preventDefault();
                                                ev.stopPropagation();
                                            }
                                            currentPage++;
                                            
                                            displayResults(filteredResults, document.getElementById('searchInput').value);
                                        }
                                        
                                        
                                        function goToLesson(lessonId) {
                                            document.getElementById('searchResults').style.display = 'none';
                                            scrollToLesson(lessonId);
                                        }
                                        
                                        document.getElementById('searchInput').addEventListener('input', function(e) {
                                            performSearch(e.target.value);
                                        });
                                        
                                        
                                        
                                        document.addEventListener('click', function(e) {
                                            if (e.target.closest('.search-wrapper')) return;
                                            if (e.target.closest('.ver-mais-btn')) return;
                                        
                                            document.getElementById('searchResults').style.display = 'none';
                                        });
                                        
                                        document.getElementById('toggleModulesBtn').addEventListener('click', function() {
                                            const modules = document.querySelector('.modules');
                                            const button = this;
                                            const isOpen = modules.classList.contains('show');
                                            modules.classList.toggle('show', !isOpen);
                                            button.textContent = isOpen ? 'Abrir pesquisa por módulos' : 'Fechar pesquisa por módulos';
                                            button.classList.toggle('active', !isOpen);
                                        });
                                        
                                        function toggleNivel() {
                                            const content = document.getElementById("nivelContent");
                                            const toggleBtn = document.querySelector(".toggle-nivel");
                                            const aberto = content.style.display === "block";
                                            content.style.display = aberto ? "none" : "block";
                                            toggleBtn.textContent = aberto
                                                ? "Veja em qual nível de violão você está"
                                                : "Veja em qual nível de violão você está (fechar)";
                                        }
                                    `;
                                    document.body.appendChild(script);
                                    document.getElementById('loading').style.display = 'none';
                                }).catch(error => console.error('Erro ao carregar conteúdo:', error));
                            } else {
                                alert('Acesso negado.');
                                auth.signOut();
                                const urlParams = new URLSearchParams(window.location.search);
                                const from = urlParams.get('from');
                                window.location.href = `fechado_geral_protegido.html${from ? '?from=' + from : ''}`;
                            }
                        })
                        .catch(error => console.error('Erro ao verificar aluno:', error));
                } else {
                    const urlParams = new URLSearchParams(window.location.search);
                    const from = urlParams.get('from');
                    window.location.href = `fechado_geral_protegido.html${from ? '?from=' + from : ''}`;
                }
            });
        }
    
        function loadVideo(element) {
            const src = element.getAttribute('data-src');
            element.innerHTML = `<iframe src="${src}?autoplay=1&rel=0&showinfo=0&iv_load_policy=3&modestbranding=1" frameborder="0" allowfullscreen></iframe>`;
        }

        function logout() {
            auth.signOut().then(() => {
                window.location.href = 'fechado_geral_protegido.html';
            }).catch((error) => {
                console.error('Erro ao fazer logout:', error);
                alert('Erro ao sair. Tente novamente.');
            });
        }
    </script>
    <style>
     
        #loading {
            text-align: center;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            font-family: Arial, sans-serif;
            color: #999999;
        }
    </style>

    
</body>

</html>
